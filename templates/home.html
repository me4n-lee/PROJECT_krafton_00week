<!DOCTYPE html>
<html>

<head>
	<title>Home</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
	<div class="w-[1200px] mx-auto overflow-hidden">
		<header class="block overflow-hidden mb-[20px] mt-[20px]">
			<h1 class="text-left text-3xl float-left">HOME</h1>
			<div class="float-right">
				<button class="bg-green-300 text-2xl rounded-lg w-[150px] h-[50px]" type="submit" name="mypage"
					id="mypage" onclick="location.href='/mypage'">마이페이지</button>
				<button class="bg-gray-300 text-2xl rounded-lg w-[150px] h-[50px]" type="submit" name="logout"
					onclick="logout()">로그아웃</button>
			</div>
		</header>
		<div class="bg-gray-300 w-[300px] h-[700px] float-left text-3xl p-[40px]">
			<div class="dropdown bg-white mb-[20px] p-[5px]">
				<span class="font-bold mb-[20px] dropdown mb-[10px]">프론트엔드</span>
				<ul class="list-disc pl-[40px] text-2xl dropdown-content hidden mt-[10px]">
					<li class="category cursor-pointer" onclick="category()">HTML</li>
					<li class="category cursor-pointer" onclick="category()">CSS</li>
					<li class="category cursor-pointer" onclick="category()">JAVASCRIPT</li>
				</ul>
			</div>
			<div class="dropdown bg-white mb-[20px] p-[5px]">
				<span class="font-bold mb-[20px] mt-[30px] dropdown">백엔드</span>
				<ul class="list-disc pl-[40px] text-2xl dropdown-content hidden mt-[10px]">
					<li class="category cursor-pointer" onclick="category()">PYTHON</li>
					<li class="category cursor-pointer" onclick="category()">JAVA</li>
					<li class="category cursor-pointer" onclick="category()">JSP</li>
				</ul>
			</div>
			<div class="dropdown bg-white mb-[20px] p-[5px]">
				<span class="font-bold mb-[20px] mt-[30px] dropdown">SERVER</span>
				<ul class="list-disc pl-[40px] text-2xl dropdown-content hidden mt-[10px]">
					<li class="category cursor-pointer" onclick="category()">FLASK</li>
				</ul>
			</div>
			<div class="dropdown bg-white mb-[20px] p-[5px]">
				<span class="font-bold mb-[20px] mt-[30px] dropdown">DB</span>
				<ul class="list-disc pl-[40px] text-2xl dropdown-content hidden mt-[10px]">
					<li class="category cursor-pointer" onclick="category()">MONGODB</li>
				</ul>
			</div>
		</div>
		<div class="bg-gray-300 w-[850px] h-[700px] float-right overflow-auto">
			<section id="search-section">
				<div id="search-bar"
					class="mx-auto display-block bg-white w-[600px] h-[50px] rounded-lg mb-[30px] mt-[30px]">
					<input type="text" placeholder="Search..." class="rounded-lg w-[400px] h-[50px]" id="searching">
					<button onclick="search()" class="float-right h-[50px] mr-[10px]">Search</button>
				</div>
			</section>
			<section id="content-section" class="w-[600px] mx-auto">

			</section>
		</div>
		<button type="submit" name="makecontent" onclick="location.href='/write'"
			class="block clear-both float-right bg-green-300 rounded-lg text-2xl font-bold w-[150px] h-[50px] mt-[10px]">글쓰기</button>
	</div>
	<a href="/mypage" id="mypage-link">My Page</a>
	<!-- JavaScript -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


	<!-- <script>
		$(document).ready(function () {
			// 페이지 로딩 시, Ajax로 /api/get_articles 요청을 보내서 content-section에 아티클을 추가합니다.
			showArticle();
		});
		function showArticle() {
			$.ajax({
				type: 'GET',
				url: '/api/get_articles',
				beforeSend: function (xhr) {
					var token = getCookie('access_token');
					if (token) {
						xhr.setRequestHeader('Authorization', 'Bearer ' + token);
					}
				success: function (response) {
					var articles = response['articles'];
					for (let i = 0; i < articles.length; i++) {
						makeArticle(articles[i]["title"], articles[i]["content"], articles[i]["url"], articles[i]["category"], articles[i]["id"]);
					}
				}
			});
		};
		function makeArticle(title, content, url, category, id) {
			let temp_html = `
			<div class='content-box mb-[30px] bg-white' onclick="location.href='/content?id=${id}'">
				<h3 class="text-3xl font-bold">${title}</h3>
				<p class="text-2xl">${content}</p>
				<p>${url}</p>
				<p>${category}</p>
				<p style="display:none">${id}</p>
			</div>
				`
			$("#content-section").append(temp_html);
		}
		function deleteCookie(name) {
			document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/';
		}

		function logout() {
			deleteCookie('access_token'); // 토큰 삭제
			window.location.href = '/'; // 로그인 페이지로 이동
		}

	</script> -->


	<script>
		$(document).ready(function () {
			// 페이지 로딩 시, Ajax로 /api/get_articles 요청을 보내서 content-section에 아티클을 추가합니다.
			showArticle();
		});

		$(document).ready(function () {
			$(".dropdown").hover(function () {
				$(this).find(".dropdown-content").show();
			}, function () {
				$(this).find(".dropdown-content").hide();
			});
		});

		//준익 추가
		function search() {
			let search_data = $("#searching").val();

			$.ajax({
				type: 'GET',
				url: '/api/search',
				data: { 'data_give': search_data },
				success: function (response) {
					let categories = response['articles'];
					$("#content-section").html("");
					for (let i = 0; i < categories.length; i++) {
						makeArticle(categories[i]["title"], categories[i]["content"], categories[i]["url"], categories[i]["category"], categories[i]["id"]);
					}
				}
			});
		}

		function category() {

			$(".category").click(function () {

				let type = $(this).text();
				$.ajax({
					type: 'GET',
					url: '/api/type',
					data: { 'type_give': type },
					success: function (response) {
						let categories = response['category'];
						$("#content-section").html("");
						for (let i = 0; i < categories.length; i++) {
							makeArticle(categories[i]["title"], categories[i]["content"], categories[i]["url"], categories[i]["category"], categories[i]["id"]);
						}
					}
				});

			})
		}

		function getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2) return parts.pop().split(';').shift();
		}

		function showArticle() {
			$.ajax({
				type: 'GET',
				url: '/api/get_articles',
				beforeSend: function (xhr) {
					var token = getCookie('access_token');
					if (token) {
						xhr.setRequestHeader('Authorization', 'Bearer ' + token);
					}
				},
				success: function (response) {
					var articles = response['articles'];
					for (let i = 0; i < articles.length; i++) {
						makeArticle(articles[i]["title"], articles[i]["content"], articles[i]["url"], articles[i]["category"], articles[i]["id"]);
					}
				}
			});
		};

		function makeArticle(title, content, url, category, id) {
			let temp_html = `
				<div class='cursor-pointer content-box mb-[30px] bg-white' onclick="location.href='/content?id=${id}'">
					<h3 class="text-3xl font-bold">${title}</h3>
					<p class="text-2xl">${content}</p>
					<p>${url}</p>
					<p>${category}</p>
					<p style="display:none">${id}</p>
				</div>
			`
			$("#content-section").append(temp_html);
		}

		function deleteCookie(name) {
			document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/';
		}

		function logout() {
			deleteCookie('access_token'); // 토큰 삭제
			window.location.href = '/'; // 로그인 페이지로 이동
		}
	</script>
</body>

</html>