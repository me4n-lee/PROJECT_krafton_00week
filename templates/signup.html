<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Sign Up</title>
</head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>
<script>
    function post_signup() {
        let id = $("#post-id").val();
        let password = $("#post-password").val();
        let check_password = $("#post-check_password").val();
        let nickname = $("#post-nickname").val();
        let name = $("#post-name").val();

        if (password != check_password) {
            alert("비밀번호와 비밀번호 확인이 일치하지 않습니다.");
            return;
        }

        // 2. memo에 POST 방식으로 메모 생성 요청하기
        $.ajax({
            type: "POST",
            url: "/api/check_duplication",
            data: { id: id, nickname: nickname },
            success: function (response) {
            if (response.result === "success") {
                // No duplication
                $.ajax({
                type: "POST",
                url: "/api/signup",
                data: { id_give: id, password_give: password, check_password_give: check_password, nickname_give: nickname, name_give: name },
                success: function (response) {
                    if (response["result"] == "success") {
                    alert("회원가입 성공!");
                    window.location.reload();
                    } else {
                    alert("서버 오류!");
                    }
                }
                });
            } else {
                // Duplication found
                alert(response.message);
            }
            }
        });
    }
</script>

<body>
    <main>
        <label for="id">ID:</label>
        <input type="text" id="post-id" name="id" required><br><br>
        <label for="password">Password:</label>
        <input type="password" id="post-password" name="password" required><br><br>
        <label for="check_password">Check Password:</label>
        <input type="password" id="post-check_password" name="check_password" required><br><br>
        <label for="nickname">Nickname:</label>
        <input type="text" id="post-nickname" name="nickname" required><br><br>
        <label for="name">Name:</label>
        <input type="text" id="post-name" name="name" required><br><br>
        <button type="submit" name="confirm" onclick="post_signup()">Confirm</button>
        <button type="submit" name="return" onclick="location.href='/'">Return to login</button>
    </main>
</body>

</html>